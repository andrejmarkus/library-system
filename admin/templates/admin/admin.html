{% extends 'general/base.html' %}
{% from 'general/BookCard.html' import BookCard %}

{% block title %}
	Admin
{% endblock %}

{% block head %}
	<script>
        function deleteBook(bookId) {
            fetch(`/admin/delete-book/${bookId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => document.getElementById(`book-${bookId}`).remove())
        }
    </script>
{% endblock %}

{% block body %}
    <h3 class="title is-3">Add a book</h3>

	<form method="post" action="{{ url_for("admin.add_book") }}" enctype="multipart/form-data">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div>
                    {{ messages[0] }}.
                </div>
            {% endif %}
        {% endwith %}

        <div class="field">
            <label class="label" for="file">Image</label>
            <div class="file has-name">
              <label class="file-label">
                <input id="file-input" class="file-input" type="file" name="file" required />
                <span class="file-cta">
                  <span class="file-icon">
                    <i class="fas fa-upload"></i>
                  </span>
                  <span class="file-label"> Choose a fileâ€¦ </span>
                </span>
                <span id="file-name" class="file-name">No file chosen</span>
              </label>
            </div>
        </div>

        <div class="field">
            <label class="label" for="title">Title</label>
            <div class="control has-icons-left">
                <input class="input" type="text" name="title" placeholder="Title" required>
                <span class="icon is-small is-left">
                    <i class="fas fa-book"></i>
                </span>
            </div>
        </div>

        <div class="field">
            <label class="label" for="author">Author</label>
            <div class="control has-icons-left">
                <input class="input" type="text" name="author" placeholder="Author" required>
                <span class="icon is-small is-left">
                    <i class="fas fa-pencil-alt"></i>
                </span>
            </div>
        </div>

        <div class="field">
            <label class="label" for="publisher">Publisher</label>
            <div class="control has-icons-left">
                <input class="input" type="text" name="publisher" placeholder="Publisher" required>
                <span class="icon is-small is-left">
                    <i class="fas fa-building"></i>
                </span>
            </div>
        </div>

        <div class="field">
            <label class="label" for="year">Year</label>
            <div class="control has-icons-left">
                <input class="input" type="number" name="year" placeholder="Year" required>
                <span class="icon is-small is-left">
                    <i class="fas fa-calendar"></i>
                </span>
            </div>
        </div>

        <div class="field">
            <label class="label" for="genre">Genre</label>
            <div class="control has-icons-left">
                <div class="select">
                    <select name="genre" required>
                        <option value="Fiction">Fiction</option>
                        <option value="Non-fiction">Non-Fiction</option>
                        <option value="Mystery">Mystery</option>
                        <option value="Thriller">Thriller</option>
                        <option value="Romance">Romance</option>
                        <option value="Sci-Fi">Sci-Fi</option>
                        <option value="Fantasy">Fantasy</option>
                        <option value="Historical">Historical</option>
                        <option value="Biography">Biography</option>
                        <option value="Self-Help">Self-Help</option>
                        <option value="Children">Children's Book</option>
                        <option value="Young Adult">Young Adult</option>
                        <option value="Horror">Horror</option>
                        <option value="Adventure">Adventure</option>
                        <option value="Poetry">Poetry</option>
                        <option value="Graphic Novel">Graphic Novel</option>
                        <option value="Classic">Classic</option>
                        <option value="Short Stories">Short Stories</option>
                        <option value="Memoir">Memoir</option>
                        <option value="Historical Fiction">Historical Fiction</option>
                    </select>
                </div>
                <span class="icon is-small is-left">
                    <i class="fas fa-user"></i>
                </span>
            </div>
        </div>

        <div class="field">
            <label class="label" for="description">Description</label>
            <div class="control">
                <textarea class="textarea" name="description" placeholder="Description"></textarea>
            </div>
        </div>

        <div class="field">
            <div class="control">
                <button class="button is-primary" type="submit">
                    Add book
                </button>
            </div>
        </div>
    </form>

    <h3 class="title is-3 mt-4">Manage books</h3>

    <div class="grid">
        {% for book in books %}
            <div class="cell" id="book-{{ book.id }}">
                {% call BookCard(book) %}
                    {% if user.is_authenticated %}
                        <div class="card-footer-item">
                            <div class="field">
                                <button class="button is-danger" onclick="deleteBook('{{ book.id }}')">Delete</button>
                            </div>
                        </div>
                    {% endif %}
                {% endcall %}
            </div>
        {% endfor %}
    </div>

    <script>
        document.getElementById('file-input').addEventListener('change', (event) => {
            if (event.target.files[0]) {
                document.getElementById('file-name').innerHTML = event.target.files[0].name
            }
        })
    </script>
{% endblock %}